\usepackage[
  paperwidth=185mm,
  paperheight=260mm,
  inner=25mm,
  outer=20mm,
  top=20mm,
  bottom=20mm,
  includehead,includefoot,
  heightrounded
]{geometry}

\usepackage{float}      % 这行是使用 [H] 选项的前提
\usepackage{array}      % 增强表格列格式功能
\usepackage{longtable}  % 支持跨页的长表格
\usepackage{booktabs}   % 绘制高质量的三线表
\usepackage{fancyhdr}
\usepackage{fontspec}   % 页眉页脚
\usepackage{hyperref}

% 开启封面支持
\newif\ifincludecover
\includecovertrue  % 开启封面

\newcommand{\insertcover}{%
  \ifincludecover
    \input{cover}
  \fi
}

% 图片支持
% 图片支持
% ---- 统一图片行为：最大宽高 + 等比缩放（兼容裸 \includegraphics） ----
\usepackage{graphicx}
\usepackage{grffile}    % 已有也可保留：多点/空格/非 ASCII 文件名
\usepackage{adjustbox}  % 依然可用；但下面的做法不再依赖 \pandocbounded

% 1) 吞掉 Pandoc 可能生成的 alt 键（即便出错版本没用也无害）
\makeatletter
\define@key{Gin}{alt}[]{}%

% 2) 定义“最大宽/高”并把它作为 *默认* 图形键
%    含义：若图片天然尺寸超过阈值，则等比缩小；否则保持原尺寸，不放大
\newcommand{\graphicmaxwidth}{0.92\linewidth}
\newcommand{\graphicmaxheight}{0.92\textheight}
\def\maxwidth{%
  \ifdim\Gin@nat@width>\graphicmaxwidth \graphicmaxwidth \else \Gin@nat@width \fi}
\def\maxheight{%
  \ifdim\Gin@nat@height>\graphicmaxheight \graphicmaxheight \else \Gin@nat@height \fi}

% 3) 设为 graphicx 的默认键（调用时如果手动写了 width/height，会覆盖这里）
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\makeatother

% 5) 统一 figure 的默认浮动位置为 [H]（这样即使 Pandoc 不加 [H] 也生效）
\makeatletter
\def\fps@figure{H}
\makeatother

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}



\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% 字体与版面
\setmainfont{Liberation Serif}
\setsansfont{Liberation Sans}
\setCJKmainfont{Noto Serif CJK SC}
\setCJKsansfont{Noto Sans CJK SC}

% 段落样式
\setlength{\parindent}{2em} % 首行缩进
\setlength{\parskip}{0pt}   % 段间距
\linespread{1.3}            % 行距稍宽

% 标题样式
\ctexset{
  % 一级标题设置：14pt黑体，无编号
  section = {
    format = \zihao{-2}\heiti\raggedright, % 字号14pt，黑体，左对齐
    name = {}, % 清除标题名称（如“第...节”），实现无编号[2](@ref)
    number = {}, % 确保编号为空
    beforeskip = 2ex plus .2ex minus .2ex, % 标题前的垂直间距
    afterskip = 2ex plus .2ex minus .2ex,   % 标题后的垂直间距
  },
  % 二级标题设置：12pt黑体，无编号，字号比一级标题小
  subsection = {
    format = \zihao{-3}\heiti\raggedright, % 字号12pt，黑体
    name = {}, % 无编号
    number = {},
    beforeskip = 1.5ex plus .2ex minus .2ex,
    afterskip = 1ex plus .2ex minus .2ex,
  },
  % 三级标题设置：字号可进一步减小，例如小四号(12pt)，无编号
  subsubsection = {
    format = \zihao{4}\heiti\raggedright, % 字号小四(12pt)，可根据需要调整为 \zihao{-4}
    name = {},
    number = {},
    beforeskip = 1ex plus .2ex minus .2ex,
    afterskip = 0.5ex plus .2ex minus .2ex,
  }
}

% 引用样式
\renewenvironment{quote}
  {\begin{list}{}{\rightmargin\leftmargin}%
     \item\relax
     \zihao{-4}\kaishu % \zihao{-4} 10号字，\kaishu 楷体
  }
  {\end{list}}

% 目录样式
\setcounter{secnumdepth}{0} % 不编号
\setcounter{tocdepth}{0}    % 目录深度为 0，只显示 chapter
